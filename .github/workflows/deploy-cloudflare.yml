name: éƒ¨ç½²åˆ° Cloudflare Pages

# è§¦å‘æ¡ä»¶ï¼šæ¨é€åˆ° master åˆ†æ”¯æ—¶è‡ªåŠ¨æ‰§è¡Œï¼Œä¹Ÿæ”¯æŒæ‰‹åŠ¨è§¦å‘
on:
  push:
    branches:
      - master  # å½“æ¨é€åˆ° master åˆ†æ”¯æ—¶è‡ªåŠ¨è§¦å‘éƒ¨ç½²æµç¨‹
  workflow_dispatch:  # å…è®¸åœ¨ GitHub Actions ç•Œé¢æ‰‹åŠ¨è§¦å‘éƒ¨ç½²

# è®¾ç½®å¿…è¦çš„æƒé™
permissions:
  contents: read
  deployments: write

jobs:
  # éƒ¨ç½²ä»»åŠ¡ï¼šæ„å»ºå¹¶éƒ¨ç½²åˆ° Cloudflare Pages
  deploy:
    name: éƒ¨ç½²åˆ° Cloudflare Pages
    runs-on: ubuntu-latest  # ä½¿ç”¨æœ€æ–°çš„ Ubuntu è¿è¡Œç¯å¢ƒ

    steps:
      # ç¬¬ä¸€æ­¥ï¼šæ£€å‡ºä»£ç 
      - name: æ£€å‡ºæºä»£ç 
        uses: actions/checkout@v4  # è·å–ä»“åº“çš„æœ€æ–°ä»£ç 

      # ç¬¬äºŒæ­¥ï¼šé…ç½® Node.js ç¯å¢ƒ
      - name: é…ç½® Node.js å¼€å‘ç¯å¢ƒ
        uses: actions/setup-node@v4  # è®¾ç½® Node.js è¿è¡Œç¯å¢ƒ
        with:
          node-version: '20'          # ä½¿ç”¨ Node.js 20 ç‰ˆæœ¬
          cache: 'npm'                # å¯ç”¨ npm åŒ…ç®¡ç†å™¨çš„ç¼“å­˜ä»¥åŠ é€Ÿæ„å»º

      # ç¬¬ä¸‰æ­¥ï¼šå®‰è£…é¡¹ç›®ä¾èµ–
      - name: å®‰è£…é¡¹ç›®ä¾èµ–åŒ…
        run: npm ci                   # ä½¿ç”¨ npm ci å®‰è£…ä¾èµ–ï¼Œç¡®ä¿ä¾èµ–ç‰ˆæœ¬ä¸€è‡´

      # ç¬¬å››æ­¥ï¼šæ„å»ºé¡¹ç›®
      - name: æ„å»ºç”Ÿäº§ç‰ˆæœ¬
        run: npm run build            # ä½¿ç”¨ npm æ‰§è¡Œæ„å»ºå‘½ä»¤ï¼Œç”Ÿæˆå¯éƒ¨ç½²çš„é™æ€æ–‡ä»¶
        env:
          CF_PAGES: 1  # è®¾ç½® Cloudflare Pages ç¯å¢ƒå˜é‡

      # æ£€æŸ¥æ„å»ºç»“æœ
      - name: æ£€æŸ¥æ„å»ºè¾“å‡º
        run: |
          echo "æ„å»ºç›®å½•å†…å®¹ï¼š"
          ls -la dist/
          echo "æ£€æŸ¥ index.html æ˜¯å¦å­˜åœ¨ï¼š"
          if [ -f "dist/index.html" ]; then
            echo "âœ… index.html å­˜åœ¨"
          else
            echo "âŒ index.html ä¸å­˜åœ¨"
            exit 1
          fi

      # ç¬¬äº”æ­¥ï¼šéƒ¨ç½²åˆ° Cloudflare Pages
      - name: éƒ¨ç½²åˆ° Cloudflare Pages
        uses: cloudflare/pages-action@v1
        with:
          apiToken: ${{ secrets.CLOUDFLARE_API_TOKEN }}  # Cloudflare API Token
          accountId: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }} # Cloudflare Account ID
          projectName: homepage  # ä½ çš„ Cloudflare Pages é¡¹ç›®åç§°
          directory: ./dist  # æ„å»ºè¾“å‡ºç›®å½•
          gitHubToken: ${{ secrets.GITHUB_TOKEN }}  # GitHub Token ç”¨äºè¯„è®ºéƒ¨ç½²çŠ¶æ€

      # ç¬¬å…­æ­¥ï¼šéƒ¨ç½²åé€šçŸ¥ï¼ˆå¯é€‰ï¼‰
      - name: éƒ¨ç½²å®Œæˆé€šçŸ¥
        if: success()
        run: |
          echo "ğŸ‰ éƒ¨ç½²æˆåŠŸï¼"
          echo "ç½‘ç«™å·²æˆåŠŸéƒ¨ç½²åˆ° Cloudflare Pages"
          echo "é¢„è§ˆé“¾æ¥å°†åœ¨å‡ åˆ†é’Ÿåå¯ç”¨"